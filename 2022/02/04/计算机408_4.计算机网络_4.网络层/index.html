<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"2673747024.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="网络层的功能主要任务 把分组从源端传到目的段，为分组交换网的不同主机提供通信服务。网络层传输单位是数据报。  分组是数据报进行切割后形成的片段。   异构网络互联 异构网络  不同的寻址方案、不同的网络接入机制、不同的差错处理方法、不同的路由选择机制等   网络互联  将两个以上的计算机网络，通过一定的方法，用一种或多种通信处理设备（即中间设备）相互连接起来，以构成更大的网络系统   中继系统">
<meta property="og:type" content="article">
<meta property="og:title" content="网络层">
<meta property="og:url" content="https://2673747024.github.io/2022/02/04/%E8%AE%A1%E7%AE%97%E6%9C%BA408_4.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_4.%E7%BD%91%E7%BB%9C%E5%B1%82/index.html">
<meta property="og:site_name" content="mananaの博客">
<meta property="og:description" content="网络层的功能主要任务 把分组从源端传到目的段，为分组交换网的不同主机提供通信服务。网络层传输单位是数据报。  分组是数据报进行切割后形成的片段。   异构网络互联 异构网络  不同的寻址方案、不同的网络接入机制、不同的差错处理方法、不同的路由选择机制等   网络互联  将两个以上的计算机网络，通过一定的方法，用一种或多种通信处理设备（即中间设备）相互连接起来，以构成更大的网络系统   中继系统">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/3b8f19be-e800-4771-8031-5a45cd86992f-3224585.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/BEDB631967B94D461627205706.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/AEF439594C8742931627284544.jpg">
<meta property="article:published_time" content="2022-02-04T11:27:04.941Z">
<meta property="article:modified_time" content="2022-02-04T16:12:05.972Z">
<meta property="article:author" content="QQ2673747024">
<meta property="article:tag" content="写作">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://api2.mubu.com/v3/document_image/3b8f19be-e800-4771-8031-5a45cd86992f-3224585.jpg">


<link rel="canonical" href="https://2673747024.github.io/2022/02/04/%E8%AE%A1%E7%AE%97%E6%9C%BA408_4.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_4.%E7%BD%91%E7%BB%9C%E5%B1%82/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://2673747024.github.io/2022/02/04/%E8%AE%A1%E7%AE%97%E6%9C%BA408_4.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_4.%E7%BD%91%E7%BB%9C%E5%B1%82/","path":"2022/02/04/计算机408_4.计算机网络_4.网络层/","title":"网络层"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>网络层 | mananaの博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">mananaの博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录学习中的点点滴滴</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-number">1.</span> <span class="nav-text">网络层的功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E4%BB%BB%E5%8A%A1"><span class="nav-number">1.1.</span> <span class="nav-text">主要任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E6%9E%84%E7%BD%91%E7%BB%9C%E4%BA%92%E8%81%94"><span class="nav-number">1.2.</span> <span class="nav-text">异构网络互联</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E4%B8%8E%E5%88%86%E7%BB%84%E8%BD%AC%E5%8F%91"><span class="nav-number">1.3.</span> <span class="nav-text">路由选择与分组转发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="nav-number">1.4.</span> <span class="nav-text">拥塞控制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">路由算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E8%A1%A8-x2F-%E8%BD%AC%E5%8F%91%E8%A1%A8%EF%BC%9A%E5%8C%85%E6%8B%AC%E7%9B%AE%E7%9A%84%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%EF%BC%8C%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%EF%BC%8C%E4%B8%8B%E4%B8%80%E8%B7%B3IP%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.1.</span> <span class="nav-text">路由表&#x2F;转发表：包括目的网络地址，子网掩码，下一跳IP地址，接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95%EF%BC%9A"><span class="nav-number">2.2.</span> <span class="nav-text">路由算法：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95%E5%88%86%E7%B1%BB%EF%BC%9A%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="nav-number">2.3.</span> <span class="nav-text">路由算法分类：静态路由与动态路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="nav-number">2.4.</span> <span class="nav-text">动态路由算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B1%82%E6%AC%A1%E8%B7%AF%E7%94%B1"><span class="nav-number">2.5.</span> <span class="nav-text">层次路由</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IPV4"><span class="nav-number">3.</span> <span class="nav-text">IPV4</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">3.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IPV4%E5%88%86%E7%BB%84"><span class="nav-number">3.2.</span> <span class="nav-text">IPV4分组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IPV4%E5%9C%B0%E5%9D%80%E4%B8%8ENAT"><span class="nav-number">3.3.</span> <span class="nav-text">IPV4地址与NAT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E4%B8%8E%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E3%80%81CIDR"><span class="nav-number">3.4.</span> <span class="nav-text">子网划分与子网掩码、CIDR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IP%E5%9C%B0%E5%9D%80%E4%B8%8E%E7%A1%AC%E4%BB%B6%E5%9C%B0%E5%9D%80"><span class="nav-number">3.5.</span> <span class="nav-text">IP地址与硬件地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE%EF%BC%88ARP%EF%BC%89"><span class="nav-number">3.6.</span> <span class="nav-text">地址解析协议（ARP）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8D%8F%E8%AE%AE%EF%BC%88DHCP%EF%BC%89"><span class="nav-number">3.7.</span> <span class="nav-text">动态主机配置协议（DHCP）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E9%99%85%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AE%EF%BC%88ICMP%EF%BC%89"><span class="nav-number">3.8.</span> <span class="nav-text">网际控制报文协议（ICMP）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IPV6"><span class="nav-number">4.</span> <span class="nav-text">IPV6</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3IP%E5%9C%B0%E5%9D%80%E8%80%97%E5%B0%BD%E7%9A%84%E5%8A%9E%E6%B3%95"><span class="nav-number">4.1.</span> <span class="nav-text">解决IP地址耗尽的办法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IPv6%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F"><span class="nav-number">4.2.</span> <span class="nav-text">IPv6数据报格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IPv6%E4%B8%8EIPv4%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9A"><span class="nav-number">4.3.</span> <span class="nav-text">IPv6与IPv4的区别：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IPV6%E5%9C%B0%E5%9D%80"><span class="nav-number">4.4.</span> <span class="nav-text">IPV6地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IPV4%E5%90%91IPV6%E8%BF%87%E6%B8%A1%EF%BC%88IPv6%E5%A6%82%E4%BD%95%E5%85%BC%E5%AE%B9IPv4%EF%BC%89"><span class="nav-number">4.5.</span> <span class="nav-text">IPV4向IPV6过渡（IPv6如何兼容IPv4）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="nav-number">5.</span> <span class="nav-text">路由协议</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF%E5%8D%8F%E8%AE%AE%EF%BC%88RIP%EF%BC%89"><span class="nav-number">5.1.</span> <span class="nav-text">路由信息协议（RIP）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E6%94%BE%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88%EF%BC%88OSPF%EF%BC%89%E5%8D%8F%E8%AE%AE"><span class="nav-number">5.2.</span> <span class="nav-text">开放最短路径优先（OSPF）协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%B9%E7%95%8C%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE%EF%BC%88BGP%EF%BC%89"><span class="nav-number">5.3.</span> <span class="nav-text">边界网关协议（BGP）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%E6%AF%94%E8%BE%83"><span class="nav-number">5.4.</span> <span class="nav-text">路由协议比较</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IP%E7%BB%84%E6%92%AD"><span class="nav-number">6.</span> <span class="nav-text">IP组播</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E4%B8%89%E7%A7%8D%E4%BC%A0%E8%BE%93%E6%96%B9%E5%BC%8F"><span class="nav-number">6.1.</span> <span class="nav-text">IP数据报的三种传输方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%84%E6%92%AD%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-number">6.2.</span> <span class="nav-text">组播的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IP%E7%BB%84%E6%92%AD%E5%9C%B0%E5%9D%80"><span class="nav-number">6.3.</span> <span class="nav-text">IP组播地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IGMP%E4%B8%8E%E7%BB%84%E6%92%AD%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="nav-number">6.4.</span> <span class="nav-text">IGMP与组播路由算法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8IP"><span class="nav-number">7.</span> <span class="nav-text">移动IP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8IP%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-number">7.1.</span> <span class="nav-text">移动IP的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8IP%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B"><span class="nav-number">7.2.</span> <span class="nav-text">移动IP通信过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8IP%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B-1"><span class="nav-number">7.3.</span> <span class="nav-text">移动IP通信过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E8%AE%BE%E5%A4%87"><span class="nav-number">8.</span> <span class="nav-text">网络层设备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E7%9A%84%E7%BB%84%E6%88%90%E5%92%8C%E5%8A%9F%E8%83%BD"><span class="nav-number">8.1.</span> <span class="nav-text">路由器的组成和功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E8%A1%A8%E4%B8%8E%E8%B7%AF%E7%94%B1%E8%BD%AC%E5%8F%91"><span class="nav-number">8.2.</span> <span class="nav-text">路由表与路由转发</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">QQ2673747024</p>
  <div class="site-description" itemprop="description">短暂的休息不是退缩，而是为了更好地战斗</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">96</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">64</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://2673747024.github.io/2022/02/04/%E8%AE%A1%E7%AE%97%E6%9C%BA408_4.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_4.%E7%BD%91%E7%BB%9C%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QQ2673747024">
      <meta itemprop="description" content="短暂的休息不是退缩，而是为了更好地战斗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mananaの博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          网络层
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-04 19:27:04" itemprop="dateCreated datePublished" datetime="2022-02-04T19:27:04+08:00">2022-02-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-05 00:12:05" itemprop="dateModified" datetime="2022-02-05T00:12:05+08:00">2022-02-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA408/" itemprop="url" rel="index"><span itemprop="name">计算机408</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA408/4-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">4.计算机网络</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA408/4-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4-%E7%BD%91%E7%BB%9C%E5%B1%82/" itemprop="url" rel="index"><span itemprop="name">4.网络层</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>


          <span title="post.wordcount">
            字数统计：19k 字
          </span>
          <span title="post.min2read">
            &nbsp;|&nbsp;&nbsp;阅读时间≈66 分钟
          </span>

        </div>

      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="网络层的功能"><a href="#网络层的功能" class="headerlink" title="网络层的功能"></a>网络层的功能</h1><h2 id="主要任务"><a href="#主要任务" class="headerlink" title="主要任务"></a>主要任务</h2><ul>
<li><p>把分组从源端传到目的段，为分组交换网的不同主机提供通信服务。网络层传输单位是数据报。</p>
</li>
<li><p>分组是数据报进行切割后形成的片段。</p>
</li>
</ul>
<h2 id="异构网络互联"><a href="#异构网络互联" class="headerlink" title="异构网络互联"></a>异构网络互联</h2><ul>
<li><p>异构网络</p>
<ul>
<li>不同的寻址方案、不同的网络接入机制、不同的差错处理方法、不同的路由选择机制等</li>
</ul>
</li>
<li><p>网络互联</p>
<ul>
<li>将两个以上的计算机网络，通过一定的方法，用一种或多种通信处理设备（即中间设备）相互连接起来，以构成更大的网络系统</li>
</ul>
</li>
<li><p>中继系统</p>
<ul>
<li><p>网络层中继系统</p>
<ul>
<li>中继器、集线器（Hub）</li>
</ul>
</li>
<li><p>数据链路层中继系统</p>
<ul>
<li>网桥或交换机</li>
</ul>
</li>
<li><p>网络层中继系统和数据链路层中继系统备注：使用物理层或数据链路层的中继系统时，只是把一个网络扩大了，而从网络层的角度看，它仍然是同一个网络，一般并不称之为网络互联</p>
</li>
<li><p>网络层中继系统</p>
<ul>
<li><p>路由器</p>
</li>
<li><p>TCP&#x2F;IP体系在网络互联上采用的做法是在网络层（即IP层）采用标准化协议，相互连接的网络可以是异构的</p>
</li>
</ul>
</li>
<li><p>网络层以上的中继系统</p>
<ul>
<li>网关</li>
</ul>
</li>
</ul>
</li>
<li><p>虚拟互联网络</p>
<ul>
<li><p>也就是逻辑互联网络，即互联起来的各种网络结构的异构性本来是客观存在的，但是通过使用IP就可以使这些性能各异的网络在网络层上看起来好像是一个统一的网络</p>
</li>
<li><p>优点</p>
<ul>
<li>互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互联的具体的网络异构细节（如具体的编址方案、路由选择协议等）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="路由选择与分组转发"><a href="#路由选择与分组转发" class="headerlink" title="路由选择与分组转发"></a>路由选择与分组转发</h2><ul>
<li><p>功能</p>
<ul>
<li><p>路由选择（确定哪一条路径）</p>
<ul>
<li><p>根据特定的路由选择协议构造出路由表，同时经常或定期地和相邻路由器交换路由信息而不断地更新和维护路由表</p>
</li>
<li><p>按照复杂的分布式算法，根据从相邻路由器所得到的关于整个网络拓扑的变化情况，动态地改变所选择的路由</p>
</li>
</ul>
</li>
<li><p>分组转发（当一个分组到达时所采取的动作）</p>
<ul>
<li><p>处理通过路由器的数据流，关键操作是转发表查询、转发及相关的队列管理和任务调度等</p>
</li>
<li><p>路由器根据转发表将用户的IP数据表从合适的端口转发出去</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h2><ul>
<li><p>在通信子网中，因出现过量的分组而引起网络性能下降的现象称为拥塞</p>
</li>
<li><p>判断拥塞状态的方法</p>
<ul>
<li><p>轻度拥塞</p>
<ul>
<li>随着网络负载的增加，网络的吞吐量明显小于正常的吞吐量</li>
</ul>
</li>
<li><p>拥塞状态</p>
<ul>
<li>网络的吞吐量随着网络负载的增大而下降</li>
</ul>
</li>
<li><p>死锁状态</p>
<ul>
<li>网络的负载继续增大，而网络的吞吐量下降到零</li>
</ul>
</li>
</ul>
</li>
<li><p>避免拥塞控制</p>
<ul>
<li>获取网络中发生拥塞的信息，从而利用这些信息进行控制，以避免由于拥塞而出现分组的丢失，以及严重拥塞而产生网络死锁的现象</li>
</ul>
</li>
<li><p>作用</p>
<ul>
<li>确保子网能够承载所达到的流量</li>
</ul>
</li>
<li><p>实现方法</p>
<ul>
<li><p>合理优化主机、路由器及路由器内部的转发处理过程等</p>
</li>
<li><p>单一地增加资源并不能解决拥塞</p>
</li>
</ul>
</li>
<li><p>流量控制与拥塞控制的区别</p>
<ul>
<li><p>流量控制所要做的是抑制发送端发送数据的速率，以便使接收端来得及接收</p>
</li>
<li><p>拥塞控制必须确保通信子网能够传送待传送的数据，是一个全局性的问题，设计网络中所有的主机、路由器及导致网络传输能力下降的所有因素</p>
</li>
</ul>
</li>
<li><p>拥塞控制的方法</p>
<ul>
<li><p>开环控制</p>
<ul>
<li><p>设计网络时事先将有关发生拥塞的因素考虑周到，力求网络在工作时不产生拥塞</p>
</li>
<li><p>优点</p>
<ul>
<li>一种静态的预防方法，一旦整个系统启动并运行，中途就不再需要修改</li>
</ul>
</li>
</ul>
</li>
<li><p>闭环控制</p>
<ul>
<li><p>事先不考虑有关发生拥塞的各种因素，采用监测网络系统去检测，及时检测出哪里发生了拥塞，然后将拥塞信息传到合适的地方</p>
</li>
<li><p>优点</p>
<ul>
<li>基于反馈环路的概念，是一种动态的方法</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="路由算法"><a href="#路由算法" class="headerlink" title="路由算法"></a>路由算法</h1><h2 id="路由表-x2F-转发表：包括目的网络地址，子网掩码，下一跳IP地址，接口"><a href="#路由表-x2F-转发表：包括目的网络地址，子网掩码，下一跳IP地址，接口" class="headerlink" title="路由表&#x2F;转发表：包括目的网络地址，子网掩码，下一跳IP地址，接口"></a>路由表&#x2F;转发表：包括目的网络地址，子网掩码，下一跳IP地址，接口</h2><h2 id="路由算法："><a href="#路由算法：" class="headerlink" title="路由算法："></a>路由算法：</h2><ul>
<li>路由算法选择出最佳路由方式，将这个路由方式添加到路由表项中。<ul>
<li>最佳路由：相对于每一种特定要求下的较为合理的选择。一般选择经过跳数最短，传输时延（发送时延）通常大于传播时延。</li>
</ul>
</li>
</ul>
<h2 id="路由算法分类：静态路由与动态路由"><a href="#路由算法分类：静态路由与动态路由" class="headerlink" title="路由算法分类：静态路由与动态路由"></a>路由算法分类：静态路由与动态路由</h2><ul>
<li><p>静态路由算法（又称非自适应路由算法）</p>
<ul>
<li><p>概念</p>
<ul>
<li><p>由网络管理员手工配置的路由信息</p>
</li>
<li><p>手动配置：目的网络地址，子网掩码，下一跳IP地址，接口</p>
</li>
<li><p>当网络的拓扑结构或链路的状态发生变化时，网络管理员需要手工去修改路由表中相关的静态路由信息</p>
</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li><p>（配置）简便、可靠（安全性高），在负荷稳定、拓扑变化不大的网络中运行效果很好（对运行协议的设备的性能要求低）</p>
<ul>
<li>拓扑变化不大：拓扑不经常变化，不会频繁的有主机加入或离开</li>
</ul>
</li>
<li><p>广泛用于高度安全性的军事网络和较小的商业网络</p>
</li>
</ul>
</li>
<li><p>缺陷</p>
<ul>
<li><p>路由更新慢</p>
<ul>
<li>发生变化后需要大范围修改和调整路由信息，人工难以频繁更新路由表</li>
</ul>
</li>
<li><p>管理员难以全面了解网络拓扑结构</p>
</li>
</ul>
</li>
<li><p>使用范围</p>
<ul>
<li><p>广泛用于高度安全的军事系统和较小的商业网络</p>
</li>
<li><p>不适用于大型和复杂的网络环境</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>动态路由算法（又称自适应路由算法）</p>
<ul>
<li><p>概念</p>
<ul>
<li><p>路由器上的路由表项是通过相互连接的路由器之间彼此交换信息，然后按照一定的路由算法优化出路由表项</p>
</li>
<li><p>路由信息会在一定时间间隙里不断更新，以适应不断变化的网络，随时获得最优的寻路效果。</p>
</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li><p>路由更新快，能够及时响应链路费用或网络拓扑变化</p>
<ul>
<li>链路费用：路经的代价，或者为跳数</li>
</ul>
</li>
<li><p>改善网络的性能（根据链路费用及时改变路径）并有助于流量控制（根据链路上负载状况更改路径）</p>
</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li><p>算法本身比较复杂，运行时会增加网络的负担</p>
</li>
<li><p>路由算法设计复杂</p>
<ul>
<li>防止路由器对动态变化的反应太快而引起振荡，或反应太慢而影响网络路由的一致性</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="动态路由算法"><a href="#动态路由算法" class="headerlink" title="动态路由算法"></a>动态路由算法</h2><ul>
<li><p>距离—向量路由算法（分散性算法）</p>
<ul>
<li><p>原理</p>
<ul>
<li><p>所有结点都定期地将它们的整个路由选择表传送给所有与之直接相邻的结点</p>
</li>
<li><p>路由器只掌握物理相邻的邻居及链路费用</p>
</li>
</ul>
</li>
<li><p>更新路由表的条化</p>
<ul>
<li><p>被通告一条新的路由，该路由在本结点的路由表中不存在，此时本地系统加入这条新的路由</p>
</li>
<li><p>来的路由信息中有一条到达某个目的地的路由，该路由与当前使用的路由相比，有较短的距离（较小的代价）</p>
</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>容易出现路由环路问题</li>
</ul>
</li>
<li><p>最常见的距离一向量路由算法是RIP算法，它采用“跳数”作为距离的度量</p>
</li>
</ul>
</li>
<li><p>链路状态路由算法（全局性算法）</p>
<ul>
<li><p>原理</p>
<ul>
<li><p>链路状态路由算法要求每个参与该算法的结点都具有完全的网络拓扑和链路费用信息</p>
</li>
<li><p>主动测试所有邻接结点的状态</p>
</li>
<li><p>定期地将链路状态传播给所有其他结点（或称路由结点）</p>
</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li><p>使用泛洪法向所有相邻的路由器发送信息，然后相邻路由器又向其他相邻路由器发送信息</p>
</li>
<li><p>发送的信息是与路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息</p>
</li>
<li><p>只有当链路状态发生变化时，路由器才向所有路由器发送此消息</p>
</li>
</ul>
</li>
<li><p>用于大型的或路由信息变化聚敛的互联网环境</p>
</li>
<li><p>优点</p>
<ul>
<li><p>每个路由结点都使用同样的原始状态数据独立地计算路径，而不依赖中间结点的计算</p>
</li>
<li><p>链路状态报文不加改变地传播，因此采用该算法易于查找故障</p>
</li>
<li><p>当一个结点从所有其他结点接收到报文时，它可以在本地立即计算正确的通路，保证一步汇聚</p>
</li>
<li><p>链路状态算法比距离—向量算法有更好的规模可伸展性</p>
</li>
</ul>
</li>
<li><p>典型的链路状态算法是OSPF算法</p>
</li>
</ul>
</li>
</ul>
<h2 id="层次路由"><a href="#层次路由" class="headerlink" title="层次路由"></a>层次路由</h2><ul>
<li><p>背景</p>
<ul>
<li><p>当网络规模扩大时，路由器的路由表成比例地增大</p>
<ul>
<li>这不仅会消耗越来越多的路由器缓冲区空间，而且需要用更多CPU时间来扫描路由表，用更多的带宽来交换路由状态信息</li>
</ul>
</li>
<li><p>许多单位不想让外界知道直接的路由协议，但还想接入因特网</p>
</li>
</ul>
</li>
<li><p>自治系统（AS）</p>
<ul>
<li><p>概述</p>
<ul>
<li><p>单一技术管理下的一组路由器，这些路由器使用一种AS内部的路由选择协议和共同的度量来确定分组在该AS内的路由</p>
<ul>
<li>一个AS内的所有网络都属于一个行政单位来管辖，一个AS内的所有路由器都必须相互连通。</li>
</ul>
</li>
<li><p>同时还使用一种AS之间的路由选择协议来确定分组在AS之间的路由</p>
</li>
</ul>
</li>
<li><p>AS内部路由器不了解AS外部的路由协议，AS外部路由器 也不了解AS内部路由器，减小了路由器的负担</p>
</li>
</ul>
</li>
<li><p>路由选择协议分为：域内路由协议和域间路由协议</p>
<ul>
<li><p>内部网关协议（IGP）</p>
<ul>
<li><p>自治系统内部所使用的路由选择协议</p>
</li>
<li><p>常见：RIP，OSPF</p>
</li>
<li><p>目前内部网关协议使用的最多</p>
</li>
</ul>
</li>
<li><p>外部网关协议（ EGP）</p>
<ul>
<li><p>不同自治系统的路由器之间交换路由信息，并负责为分组在不同自治系统之间选择最优的路径</p>
<ul>
<li>源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时（两个自治系统可能使用不同的IGP ）需要使用一种协议将路由选择信息传递到另一个自治系统中</li>
</ul>
</li>
<li><p>常见：BGP-4</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li><p>每个路由器都知道在本AS内如何把分组路由到目的地的细节（路由），但（除边界路由器外的）不知道本AS外（AS和AS之间和其他AS内）的结构</p>
</li>
<li><p>使交换信息的种类增多，但也会使OSPF协议更加复杂</p>
</li>
</ul>
</li>
</ul>
<h1 id="IPV4"><a href="#IPV4" class="headerlink" title="IPV4"></a>IPV4</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul>
<li><p>IPV4即现在普遍使用的IP （版本4）</p>
</li>
<li><p>IP定义数据传送的基本单元——IP分组及其确切的数据格式</p>
</li>
<li><p>IP也包括一套规则，指明分组如何处理、错误怎样控制</p>
</li>
<li><p>包含非可靠投递的思想，以及与此关联的分组路由选择的思想</p>
</li>
</ul>
<h2 id="IPV4分组"><a href="#IPV4分组" class="headerlink" title="IPV4分组"></a>IPV4分组</h2><ul>
<li><p>IPV4分组格式</p>
<ul>
<li><p>首部的固定部分（20字节）</p>
<ul>
<li><p>版本：指IP版本，目前广泛使用的版本号是4</p>
</li>
<li><p>首部长度：占4位。基本单位为4B ，最大值为60B （ 15*4B ），最常用的首部长度是20B</p>
</li>
<li><p>区分服务：占8位，指期望获取哪种类型的服务，设置数据报的优先级。</p>
</li>
<li><p>总长度：占16位。基本单位为1B，指首部与数据之和（整个IP数据报）的长度最大长度65535B。长度远不会达到上限值，长度过大就会进行分片。</p>
</li>
<li><p>标识：占16位。同一数据报的分片使用同一标识，是一个计数器，用于保证数据报片能够正确组装成原来的数据报</p>
</li>
<li><p>标志：占3位，最低位MF，中间位DF</p>
<ul>
<li><p>MF （ more fragment）：为1代表进行了分片且后面还有分片，为1代表这是最后一片或者没有进行分片。只有在DF为0时，MF才有意义。</p>
</li>
<li><p>DF (don’t fragment) :为0时才可以进行分片，为1时不允许分片</p>
</li>
</ul>
</li>
<li><p>片偏移：占13位，指出分片后，某片在原分组中的相对位置。片偏移以8个字节为偏移单位，即除最后一个分片外的每个分片的长度一定是8B（64位）的整数倍。</p>
</li>
<li><p>生存时间TTL：占8位，保证分组不会在网络中循环，每次路由转发TTL-1，当TTL为0，丢弃该分组。</p>
</li>
<li><p>协议：占8位指出该分组的数据部分所使用的协议（6为TCP协议17为UDP协议）</p>
</li>
<li><p>首部校验和：占16位，IP数据报的首部校验和只校验分组的首部，而不校验数据部分。每经过一台路由器都要重新计算首部检验和，因为生存时间&#x2F;标志&#x2F;片偏移都有可能改变。判断首部是否出错，出错则丢弃。</p>
</li>
<li><p>源地址字段：占4B，标识发送发的IP地址</p>
</li>
<li><p>目的地址字段：占4B，标识接收方的IP地址</p>
</li>
</ul>
</li>
<li><p>首部的可变部分</p>
<ul>
<li><p>可选字段：用来支持排错，测量以及安全措施。</p>
</li>
<li><p>填充字段：全0，将首部长度填充成4字节的整数倍。</p>
</li>
</ul>
</li>
<li><p>数据部分</p>
</li>
</ul>
</li>
<li><p>字段单位总结：</p>
<ul>
<li><p>总长度单位：1字节</p>
</li>
<li><p>片偏移单位：8字节</p>
</li>
<li><p>首部长度单位：4字节</p>
</li>
</ul>
</li>
<li><p>IP数据报分片</p>
<ul>
<li><p>最大传送单元（MTU） ：一个链路层数据报能承载的最大数据量</p>
</li>
<li><p>MTU</p>
<ul>
<li><p>以太网：1500B</p>
</li>
<li><p>广域网：一般不超过576B</p>
</li>
</ul>
</li>
<li><p>分片：当数据报长度大于链路MTU时，就要对其进行分片传输</p>
</li>
<li><p>分片会在目的地进行组装，不会在中间路由处进行组装</p>
</li>
</ul>
</li>
<li><p>网络层转发分组的流程</p>
<ul>
<li><p>提取目的主机的IP地址</p>
</li>
<li><p>直接交付或者根据路由表进行转发交付</p>
</li>
<li><p>若找不到目标路由就发送给默认路由</p>
</li>
<li><p>如果最后没有转发成功，就报告转发分组出错</p>
</li>
</ul>
</li>
</ul>
<h2 id="IPV4地址与NAT"><a href="#IPV4地址与NAT" class="headerlink" title="IPV4地址与NAT"></a>IPV4地址与NAT</h2><ul>
<li><p>IPV4地址</p>
<ul>
<li><p>IP地址</p>
<ul>
<li><p>连接到因特网上的每台主机（或路由器）都分配一个32比特的全球唯一标识符</p>
</li>
<li><p>标识主机或路由器的接口</p>
</li>
</ul>
</li>
<li><p>IP编址的历史阶段</p>
<ul>
<li><p>第一阶段：分类的IP地址</p>
</li>
<li><p>第二阶段：子网的划分</p>
</li>
<li><p>第三阶段：构成超网（无分类编址方法）</p>
</li>
</ul>
</li>
<li><p>分类</p>
<ul>
<li><p>A类（1-126）</p>
<ul>
<li><p>最大可用网络数：2^7-2（全0，环回地址127）</p>
</li>
<li><p>第一个可用网络号：1，最后一个可用网络号：126</p>
</li>
<li><p>每个网络中的最大主机数：2^24-2（全0-网络号，全1-广播地址）</p>
</li>
</ul>
</li>
<li><p>B类(128-191)</p>
<ul>
<li><p>最大可用网络数：2^14-1（网络号128.0不分配）</p>
</li>
<li><p>第一个可用的网络号：128.1，最后一个可用的网络号：191.255</p>
</li>
<li><p>每个网络中最大主机数：2^16-2</p>
</li>
</ul>
</li>
<li><p>C类(192-223)</p>
<ul>
<li><p>最大可用网络数：2^21-1（网络号192.0.0不分配）</p>
</li>
<li><p>第一个可用的网络号：192.0.1，最后一个可用的网络号：223.255.255</p>
</li>
<li><p>每个网络中最大主机数：2^8-2</p>
</li>
</ul>
</li>
<li><p>D 类（224–239）</p>
</li>
<li><p>E 类(240-255)</p>
</li>
<li><p>图示<img src="https://api2.mubu.com/v3/document_image/3b8f19be-e800-4771-8031-5a45cd86992f-3224585.jpg" alt="img"></p>
</li>
</ul>
</li>
<li><p>特殊含义地址</p>
<ul>
<li><p>32位全为0，可以作为IP分组源地址，不能作为IP分组的目的地址，即0.0.0.0表示本网络上的本主机</p>
</li>
<li><p>网络号全为0，主机号为特定值，可以作为IP分组源地址，不能作为IP分组的目的地址，即表示本网内的某个特定主机</p>
</li>
<li><p>特殊含义地址32位全为1，即255.255.255.255表示整个TCP&#x2F;P网络的广播地址，又称受限广播地址，不能作为IP分组源地址，可以作为IP分组的目的地址，路由器不转发（路由器隔离广播域，不会将该分组转发出去），实际使用时，由于路由器对广播域的隔离， 255.255.255.255等效为本网络的广播地址</p>
</li>
<li><p>网络号是特定值，主机号全为0表示本网络本身，如202.98.174.0，不能作为IP分组源地址，不能作为IP分组的目的地址</p>
</li>
<li><p>网络号是特定值，主机号全为1表示特定网络的广播地址，又称直接广播地址，如202.98.174.255，可以不是本网络</p>
</li>
<li><p>网络号为127，主机号为非全0&#x2F;1，保留为环路自检（Loopback Test）地址，此地址表示任意主机本身，目的地址为环回地址的IP数据报永远不会出现在任何网络上（永远不会离开主机），用于本地软件环回测试，称为环回地址</p>
</li>
</ul>
</li>
<li><p>私有IP地址</p>
<ul>
<li><p>A类：10.0.0.0～10.255.255.255，网段：1个</p>
</li>
<li><p>B类：172.16.0.0～172.31.255.255，网段：16个</p>
</li>
<li><p>C类：192.168.0.0～192.168.255.255，网段：256个</p>
</li>
<li><p>内部网络使用的IP地址，在外部网络上，这些IP地址是无效的</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>网络地址转换（NAT）</p>
<ul>
<li><p>概述</p>
<ul>
<li><p>通过将专用网络地址（如Intranet ）转换为公用地址（如Internet ），从而对外隐藏内部管理的IP地址</p>
</li>
<li><p>在专用网连接到因特网的路由器上安装NAT软件，安装了NAT软件的路由器叫NAT路由器，它至少有一个外部有效的全球IP地址。</p>
</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li><p>只需要一个全球IP地址就可以与因特网连通，由于专用网本地IP地址是可重用的，所以NAT大大节省了IP地址的消耗</p>
</li>
<li><p>隐藏了内部网络结构，从而降低了内部网络受到攻击的风险</p>
</li>
</ul>
</li>
<li><p>具体实现</p>
<ul>
<li><p>本地地址的主机和外界通信时， NAT路由器使用NAT转换表将本地地址转换成全球地址，或将全球地址转换成本地地址</p>
</li>
<li><p>NAT转换表</p>
<ul>
<li><p>WAN端（广域网端）</p>
<ul>
<li>IP地址+端口号，例：172.38.1.5:40001</li>
</ul>
</li>
<li><p>LAN端（局域网端）</p>
<ul>
<li>IP地址+端口号，例：192.168.0.3:30000</li>
</ul>
</li>
</ul>
</li>
<li><p>实现过程</p>
<ul>
<li><p>主机A向主机B发送数据报，封装源IP：192.168.0.3，目的IP：213.18.2.4，端口号为30000</p>
</li>
<li><p>数据报到达NAT路由器时，使用NAT转换表对应的WAN端IP和端口号，替换源IP地址和端口号。</p>
</li>
<li><p>主机B向主机A发送数据报，封装目的IP：172.38.1.5，源IP：213.18.2.4，端口号为40001</p>
</li>
<li><p>数据报到达NAT路由器时，根据NAT转换表对应的LAN端IP和端口号，替换目的地址和端口号。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>注意</p>
<ul>
<li><p>普通路由器在转发IP数据报时，不改变其源IP地址和目的IP地址</p>
</li>
<li><p>NAT路由器在转发IP数据报时，一定要更换其IP地址</p>
</li>
<li><p>普通路由器仅工作在网络层</p>
</li>
<li><p>NAT路由器转发数据报时需要查看和转换传输层的端口号</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="子网划分与子网掩码、CIDR"><a href="#子网划分与子网掩码、CIDR" class="headerlink" title="子网划分与子网掩码、CIDR"></a>子网划分与子网掩码、CIDR</h2><ul>
<li><p>子网划分</p>
<ul>
<li><p>背景</p>
<ul>
<li><p>两级IP地址的缺点</p>
<ul>
<li><p>IP地址空间的利用率有时很低</p>
<ul>
<li>为了未来的可扩展性，每个公司在申请IP地址的时候都会申请较多的IP地址，就造成了部分IP地址未使用</li>
</ul>
</li>
<li><p>两级的IP地址不够灵活</p>
<ul>
<li>每次申请一个网络时，都需要向ISP申请，使得创建新网络不够灵活</li>
</ul>
</li>
<li><p>会使路由表变得太大而使网络性能变坏</p>
<ul>
<li>一个A类网络内的任何一台路由器都要加载特别大的路由表</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>概述</p>
<ul>
<li>两级IP地址变成了三级IP地址，从主机号中拿出一部分作为子网号。</li>
</ul>
</li>
<li><p>划分思路</p>
<ul>
<li><p>子网划分纯属一个单位内部的事情，单位对外仍然表现为没有划分子网的网络</p>
</li>
<li><p>从主机号借用若干比特作为子网号，当然主机号也就相应减少了相同的比特划分，主机位最少保留两位（全0，全1不能用）</p>
</li>
<li><p>IP地址&#x3D;{（网络号），（子网号），（主机号）}</p>
</li>
<li><p>先找到连接到本单位网络上的路由器。然后该路由器在收到IP数据报后，按目的网络号和子网号找到目的子网。最后把IP数据报直接交付给目的主机</p>
</li>
</ul>
</li>
<li><p>注意</p>
<ul>
<li><p>在最初对IPv4地址进行子网划分的时候，子网号不能全为0和全为1。但是随着CIDR的广泛应用，目前全0和全1的字网号也可以使用，使用时应注意路由器的路由选择软件是否支持全0和全1的子网号</p>
</li>
<li><p>主机号全为0为本网络号，全为1为子网的广播地址，不能作为主机地址</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>子网掩码（本单位网络的路由器发给哪个子网）</p>
<ul>
<li><p>使用子网掩码来表达对原网络的借位</p>
</li>
<li><p>分类</p>
<ul>
<li><p>A类：255.0.0.0</p>
</li>
<li><p>B类： 255.255.0.0</p>
</li>
<li><p>C类: 255.255.255.0</p>
</li>
</ul>
</li>
<li><p>使用子网掩码情况</p>
<ul>
<li><p>一台主机在设置IP地址的同时必须设置子网掩码</p>
</li>
<li><p>同属于一个子网的所有主机及路由器的相应端口，必须设置相同的子网掩码</p>
</li>
<li><p>路由表中必须包含有目的网络地址，子网掩码，下一跳地址</p>
</li>
</ul>
</li>
<li><p>子网网络地址的计算</p>
<ul>
<li>使用子网掩码和IP地址相与（都是1，则为1；否则为0）</li>
</ul>
</li>
</ul>
</li>
<li><p>使用子网时分组转发过程</p>
<ul>
<li><p>提取出数据报中的目的IP地址</p>
</li>
<li><p>判断是否直接交付（是否是和本路由器直连的网络）</p>
<ul>
<li>使用目的地址与相连网络的各个子网掩码（网络掩码可以不同）进行相与，如果得到的结果与相连网络的网络地址匹配，则转发给这个子网</li>
</ul>
</li>
<li><p>路由器中是否有特定主机路由</p>
<ul>
<li>特定主机路由在路由表中表现为IP地址+255.255.255.255，判断数据报的目的IP地址与特定主机路由的IP地址是否匹配</li>
</ul>
</li>
<li><p>检验路由表中有无路径</p>
<ul>
<li>将路由表中每一行的子网掩码与数据报的目的IP地址进行相与，如果结果与路由表中的目的网络地址相匹配，则转发给该行的下一跳路由器。</li>
</ul>
</li>
<li><p>检测是否存在默认路由，如果存在默认路由，则发给默认路由中的下一跳路由器（该路由器循环所有步骤），否则执行下一步</p>
</li>
<li><p>报告分组转发错误</p>
</li>
</ul>
</li>
<li><p>无分类域间路由选择（CIDR）</p>
<ul>
<li><p>概述</p>
<ul>
<li>无分类域间路由选择是在变长子网掩码的基础上提出的一种消除传统A、B、 C类网络划分，并且可以在软件的支持下实现超网构造的一种IP地址的划分方法</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li><p>消除了传统A、 B、 C类地址及划分子网的概念，因而可以更有效地分配Pv4的地址空间</p>
</li>
<li><p>融合子网地址与子网掩码，方便子网划分</p>
<ul>
<li>取几位主机位，和网络前缀合并为新的网络前缀</li>
</ul>
</li>
<li><p>IP&#x3D;{&lt;网络前缀&gt; ， &lt;主机号&gt;}</p>
</li>
<li><p>将网络前缀都相同的连续IP地址组成：CIDR地址块</p>
<ul>
<li>这种地址的聚合称为路由聚合，或称构成超网</li>
</ul>
</li>
<li><p>网络前缀越长，其地址块就越小，路由就越具体</p>
</li>
</ul>
</li>
<li><p>构成超网（路由聚合）</p>
<ul>
<li><p>将转发接口相同的多个子网聚合成一个较大的子网</p>
</li>
<li><p>方法：将网络前缀缩短（所有网络地址取交集，求出网络1和网络2的合体网络，写入路由表，删除网络1和网络2的路由）</p>
</li>
</ul>
</li>
<li><p>最长前缀匹配</p>
<ul>
<li>使用CIDR时，查找路由表可能得到多个匹配结果（和网络掩码按位相与），选择最长网络前缀的路由。（思想：前缀越长，地址块越小，路由越具体）</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li><p>（超网的优点）有利于减少路由器之间的路由选择信息的交换，提高网络性能</p>
</li>
<li><p>网络前缀长度具有灵活性。（上层路由器中的路由的网络前缀较短，使得路由条目少。内部又可以延长网络前缀从而灵活划分子网。使得每一层次路由器的路由条目不同，有利于提高性能）</p>
</li>
</ul>
</li>
<li><p>查找路由表使用的数据结构方法</p>
<ul>
<li>二叉线索树（层次性数据结构）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="IP地址与硬件地址"><a href="#IP地址与硬件地址" class="headerlink" title="IP地址与硬件地址"></a>IP地址与硬件地址</h2><ul>
<li><p>概述</p>
<ul>
<li><p>IP地址是网络层使用的地址，它是分层次等级的</p>
</li>
<li><p>硬件地址是数据链路层使用的地址（如MAC地址），它是平面式的</p>
</li>
<li><p>在网络层及网络层之上使用IP地址， IP地址放在IP数据报的首部，而MAC地址放在MAC帧的首部</p>
</li>
<li><p>数据链路层看不见数据报分组中的IP地址</p>
</li>
</ul>
</li>
<li><p>具体关系</p>
<ul>
<li>在网络层中的路由器相互传输时使用IP地址，当到达目标网络后，使用MAC地址查找目标物理主机</li>
</ul>
</li>
<li><p>路由器</p>
<ul>
<li><p>拥有多个IP地址</p>
</li>
<li><p>拥有多个硬件地址</p>
</li>
</ul>
</li>
</ul>
<h2 id="地址解析协议（ARP）"><a href="#地址解析协议（ARP）" class="headerlink" title="地址解析协议（ARP）"></a>地址解析协议（ARP）</h2><ul>
<li><p>作用：实现IP地址到MAC地址的映射（ARP就是为了获取目的MAC地址）</p>
</li>
<li><p>ARP表：每台主机都设有一个ARP高速缓存，用来存放本局域网上（没有局域网外的）各主机和路由器的IP地址到MAC地址的映射表</p>
</li>
<li><p>发送数据的过程</p>
<ul>
<li><p>源主机在数据链路层会封装源MAC地址和目的MAC地址（ARP就是为了获取目的MAC地址）</p>
</li>
<li><p>主机A将自己的子网掩码与目的IP地址进行相与，判断目的IP地址是否和本主机属于同一局域网。</p>
</li>
<li><p>如果属于同一个局域网：</p>
<ul>
<li><p>检查ARP高速缓存，有对应表项则写入MAC帧，没有则用目的MAC地址为全1的帧封装并广播ARP请求分组（由于目的MAC为全1，局域网内的设备会进行广播），同一局域网内的所有主机都会收到该请求。</p>
</li>
<li><p>目的主机收到请求后会向源主机单播一个ARP响应分组（带有目的主机的IP地址和MAC地址）。源主机收到后将此映射写入ARP缓存（10min-20min更新一次）。</p>
</li>
<li><p>源主机收到后就会封装该目的MAC地址。</p>
</li>
</ul>
</li>
<li><p>不属于同一个局域网中：</p>
<ul>
<li><p>主机A广播ARP请求分组（目的IP：默认网关的IP地址，目的MAC为全1），默认网关回复一个单播ARP响应分组（带有默认网关的IP地址和MAC地址）。源主机收到后将封装该MAC地址。</p>
</li>
<li><p>默认网关收到数据后进行解封装，再封装时源MAC地址为默认网关转发出去的接口的MAC地址，（如果是点对点网络的PPP协议，目的MAC地址为全1，如果是多点网络，目的MAC地址需要为下一个路由器相连接口的MAC地址（再使用一次ARP协议））。</p>
</li>
<li><p>到达目的网络后，再次使用ARP协议获取目的MAC地址。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>ARP协议特点</p>
<ul>
<li><p>必须使用MAC地址，因为局域网内部只能看懂MAC地址。ARP是为了获取目的MAC地址（IP地址到MAC地址的映射，也就是下一跳去哪的问题）</p>
</li>
<li><p>从IP地址到硬件地址的解析是自动进行的。（主机用户不知道ARP的过程）</p>
</li>
<li><p>ARP协议是处于网络层与链路层之间的协议（因为结合了IP地址和MAC地址），划分为网络层协议是因为ARP协议为IP协议提供服务。</p>
</li>
</ul>
</li>
<li><p>可能出现的情况</p>
<ul>
<li><p>发送方是主机时，要把IP数据报发送到本网络上的另一台主机：这时用ARP找到目的主机的硬件地址</p>
</li>
<li><p>发送方是主机时，要把IP数据报发送到另一个网络上的一台主机：这时用ARP找到本网络上的一个路由器（网关）的硬件地址，剩下的工作由这个路由器来完成</p>
</li>
<li><p>发送方是路由器时，要把IP数据报转发到本网络上的一台主机：这时用ARP找到目的主机的硬件地址</p>
</li>
<li><p>发送方是路由器时，要把IP数据报转发到另一个网络上的一台主机：这时用ARP找到本网络上的一个路由器的硬件地址，剩下的工作由另一个路由器完成</p>
</li>
</ul>
</li>
</ul>
<h2 id="动态主机配置协议（DHCP）"><a href="#动态主机配置协议（DHCP）" class="headerlink" title="动态主机配置协议（DHCP）"></a>动态主机配置协议（DHCP）</h2><ul>
<li><p>概述</p>
<ul>
<li><p>常用于给主机动态地分配IP地址。</p>
</li>
<li><p>提供了即插即用联网的机制，这种机制允许一台计算机加入新的网络时就自动获取IP地址而不用手工参与</p>
<ul>
<li>获取到的信息：IP地址，子网掩码，默认网关，DNS服务器的名称与IP地址。</li>
</ul>
</li>
<li><p>DHCP是应用层协议，它是基于UDP的，使用客户&#x2F;服务器方式（主机向DHCP服务器请求IP地址），客户端和服务端通过广播方式进行交互</p>
<ul>
<li>为什么？DHCP协议为网络层提供基础，只有有了IP地址，IP协议才会起作用。</li>
</ul>
</li>
<li><p>允许地址重用</p>
<ul>
<li>主机A离开本网络后，原来A使用的IP地址可以被新加入的主机B使用</li>
</ul>
</li>
<li><p>支持移动用户加入网络</p>
<ul>
<li>移动设备加入网络时，会使用DHCP服务获取IP地址。</li>
</ul>
</li>
<li><p>支持在用地址续租</p>
<ul>
<li><p>DHCP服务器分配给DHCP客户的IP地址是临时的，因此DHCP客户只能在一段有限的时间内使用这个分配到的IP地址</p>
</li>
<li><p>IP地址有租用期，租用期过了，可以对在用的IP地址续租</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>实现过程</p>
<ul>
<li><p>DHCP客户机广播“DHCP发现“消息，试图找到网络中的DHCP服务器</p>
</li>
<li><p>DHCP服务器收到“DHCP发现”消息后，向网络中广播”DHCP提供”消息，其中包括提供DHCP客户机的IP地址和相关配置信息</p>
<ul>
<li><p>如果DHCP服务器的地址池中存在可分配IP地址，则所有可提供IP地址的DHCP服务器都会回复“DHCP提供”报文</p>
</li>
<li><p>IP地址和相关配置信息是拟分配，因为可以有多台DHCP服务器同时分配</p>
</li>
</ul>
</li>
<li><p>DHCP客户机收到“DHCP提供”消息，如果接收DHCP服务器所提供的相关参数，那么通过广播“DHCP请求”消息向DHCP服务器请求提供IP地址</p>
<ul>
<li><p>主机会请求最先收到的“DHCP提供”消息中的IP地址</p>
</li>
<li><p>为什么广播：其余DHCP收到后会将拟分配IP地址放回地址池</p>
</li>
</ul>
</li>
<li><p>DHCP服务器广播”DHCP确认”消息,正式将IP地址分配给DHCP客户机</p>
</li>
</ul>
</li>
</ul>
<h2 id="网际控制报文协议（ICMP）"><a href="#网际控制报文协议（ICMP）" class="headerlink" title="网际控制报文协议（ICMP）"></a>网际控制报文协议（ICMP）</h2><ul>
<li><p>目的</p>
<ul>
<li><p>为了提高IP数据报交付成功的机会，在网络层使用了网际控制报文协议（ ICMP）来让主机或路由器报告差错和异常情况，或者网络探询</p>
</li>
<li><p>网络层收到错误分组时，直接丢弃。同时需要发送差错报文（就是ICMP报文）</p>
</li>
</ul>
</li>
<li><p>封装位置：ICMP报文封装在IP数据报的数据部分，所以ICMP是网络层协议</p>
</li>
<li><p>字段</p>
<ul>
<li><p>类型：1字节</p>
</li>
<li><p>代码：1字节，进一步区分各个类型中的不同情况</p>
</li>
<li><p>检验和：2字节，检验整个ICMP报文（IP数据报的首部检验和只检验首部，并不检验数据部分）</p>
</li>
<li><p>4个字节取决于ICMP报文类型</p>
</li>
<li><p>ICMP数据部分：长度取决于类型</p>
</li>
</ul>
</li>
<li><p>种类</p>
<ul>
<li><p>ICMP差错报告报文（5种）</p>
<ul>
<li><p>终点不可达：当路由器或主机不能向上层交付数据报时，就向源点发送终点不可达报文</p>
</li>
<li><p>源点抑制：当路由器或主机由于拥塞而丢弃数据报时，就向源点发送源点抑制报文，使源点知道应当把数据报的发送速率放慢</p>
</li>
<li><p>时间超过：当路由器收到生存时间（TTL）为零的数据报时，除丢弃该数据报外，还要向源点发送时间超过报文。在规定的时间内没有收到一个数据报的全部数据报片时，就将已收到的分片都丢弃，并向源点发送数据超过报文。</p>
</li>
<li><p>参数问题：当路由器或目的主机收到的数据报的首部中有的字段的值不正确时，就丢弃该数据报，并向源点发送参数问题报文</p>
</li>
<li><p>改变路由（重定向）：路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器（可通过更好的路由）</p>
</li>
</ul>
</li>
<li><p>ICMP差错报文的数据字段</p>
<ul>
<li><p>差错的IP数据报中的（首部和数据部分的前8字节）</p>
</li>
<li><p>ICMP的前8个字节+该ICMP的数据字段&#x3D;完整的ICMP差错报告报文</p>
</li>
<li><p>ICMP差错报告报文+IP数据报的首部&#x3D;IP数据报</p>
</li>
</ul>
</li>
<li><p>几种情况：不应发送ICMP差错报告报文</p>
<ul>
<li><p>对ICMP差错报告报文不再发送ICMP差错报告报文</p>
<ul>
<li>由于IP数据报的首部检验和不检验数据部分，数据部分（收到的ICMP差错报文）就可能出错，即使出错，也不会对ICMP差错报文发送ICMP差错差错报告</li>
</ul>
</li>
<li><p>对第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报告报文</p>
</li>
<li><p>对具有组播或广播地址的数据报都不发送ICMP差错报告报文</p>
<ul>
<li><p>组播：一点发送到多点（广播是一点发送到所有节点）</p>
</li>
<li><p>防止广播风暴</p>
</li>
</ul>
</li>
<li><p>对具有特殊地址（如127.0.0.0（环回地址）或0.0.0.0（本网络的本主机地址） ）的数据报不发送ICMP差错报告报文</p>
</li>
</ul>
</li>
<li><p>ICMP询问报文</p>
<ul>
<li><p>回送请求和回答报文</p>
<ul>
<li><p>主机或路由器向特定主机发出询问“会送请求报文”，收到该报文的特定主机必须向与源主机或路由器发送ICMP“会送回答报文”。</p>
</li>
<li><p>具体应用：PING，测试目的站是否可达，以及了解目的站的相关状态。</p>
</li>
</ul>
</li>
<li><p>时间戳请求和回答报文</p>
<ul>
<li><p>请求某个主机或路由器回答当前时间。</p>
</li>
<li><p>具体应用：用于进行时钟同步和时间的测量。</p>
</li>
</ul>
</li>
<li><p>掩码地址请求和回答报文</p>
</li>
<li><p>路由器询问和通告报文</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>ICMP的应用</p>
<ul>
<li><p>分组网间探测PING</p>
<ul>
<li><p>测试两台主机之间的连通性</p>
</li>
<li><p>使用了ICMP回送请求和回答报文</p>
</li>
<li><p>PING工作在应用层，直接使用网络层的ICMP，未使用传输层的TCP或UDP。</p>
</li>
</ul>
</li>
<li><p>Traceroute</p>
<ul>
<li><p>用来跟踪分组经过的路径</p>
</li>
<li><p>使用了ICMP时间超过报文</p>
</li>
<li><p>过程：</p>
<ul>
<li>源主机发送多个数据报。首先发送第一个数据报（TTL设置为1），收到该数据报的第一个路由器就会回复时间超过报文，然后发送第二个数据报（TTL设置为2），同理源点到终点上的所有节点都会依次回复时间超过报文。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="IPV6"><a href="#IPV6" class="headerlink" title="IPV6"></a>IPV6</h1><h2 id="解决IP地址耗尽的办法"><a href="#解决IP地址耗尽的办法" class="headerlink" title="解决IP地址耗尽的办法"></a>解决IP地址耗尽的办法</h2><p>根本方法：IPv6</p>
<p>缓解方法：超网聚合，NAT等</p>
<h2 id="IPv6数据报格式"><a href="#IPv6数据报格式" class="headerlink" title="IPv6数据报格式"></a>IPv6数据报格式</h2><ul>
<li><p>分为基本首部和有效载荷</p>
<ul>
<li><p>扩展首部放在数据载荷中，可有可无</p>
</li>
<li><p>IPv4的首部中一些不常用的字段放在扩展首部中</p>
</li>
</ul>
</li>
<li><p>基本首部</p>
<ul>
<li><p>版本：4bit，值为6，因为是IPv6版本协议</p>
</li>
<li><p>优先级：8bit，区分数据报的类别和优先级，是否对数据报进行优先处理</p>
</li>
<li><p>流标签：所有属于同一个流的数据报都有相同的流标签</p>
<ul>
<li><p>流：区分从特点源点到特定终点的一系列数据报。</p>
</li>
<li><p>对比——IPv4的标识位：同一个数据报的分片有相同的标识位</p>
</li>
</ul>
</li>
<li><p>有效载荷长度：IPv6数据报的有效载荷的长度（扩展首部+数据部分）</p>
<ul>
<li>对比——IPv4的首部长度：首部大小，IPv4的总长度字段：首部+数据部分大小</li>
</ul>
</li>
<li><p>下一个首部：标识下一个扩展首部或者是上层的协议首部。</p>
<ul>
<li><p>对于IPv6数据报的扩展首部都有下一个首部字段。</p>
</li>
<li><p>基本首部里也有下一个首部字段指向扩展首部1。扩展首部1的下一个首部字段指向扩展首部2。同理，最后一个扩展首部的首部字段指向数据部分（数据是上层的报文段，所以指向上层报文段的首部）。</p>
</li>
</ul>
</li>
<li><p>条数限制：相当于IPv4的TTL（生存时间）。</p>
<ul>
<li>如果条数限制为0，就丢弃报文，并返回ICMP差错报告报文。</li>
</ul>
</li>
<li><p>源地址：128位。</p>
<ul>
<li>对比IPv4：32位</li>
</ul>
</li>
<li><p>目的地址：128位。</p>
</li>
</ul>
</li>
</ul>
<h2 id="IPv6与IPv4的区别："><a href="#IPv6与IPv4的区别：" class="headerlink" title="IPv6与IPv4的区别："></a>IPv6与IPv4的区别：</h2><ul>
<li><p>更大的地址空间</p>
<ul>
<li>IPv6将地址从32位（4B）扩大到了128位（16B）</li>
</ul>
</li>
<li><p>移除校验和字段</p>
<ul>
<li>路由器对于数据报首部的校验时间变小，每跳的处理时间也就变小了。</li>
</ul>
</li>
<li><p>扩展的地址层次结构</p>
<ul>
<li>分为三级。第一级（顶级）：全球都知道的公共拓扑，第二级（场点级）：单个场点，第三级：单个网络接口。</li>
</ul>
</li>
<li><p>灵活的首部格式</p>
<ul>
<li><p>IPv6将IPv4的可选字段移出首部，变成了扩展首部，路由器通常不会对扩展首部进行检查，大大提高了路由器的处理和转发数据报的效率。</p>
</li>
<li><p>IPv4的首部格式分为固定部分和可变部分，且固定部分的字段种类繁多</p>
</li>
</ul>
</li>
<li><p>支持即插即用（即自动配置IP地址）</p>
<ul>
<li><p>IPv6不需要DHCP协议。</p>
</li>
<li><p>IPv4自动配置IP地址的时候需要DHCP协议，需要DHCP服务器。</p>
</li>
</ul>
</li>
<li><p>IPv6首部长度必须是8B的整数倍，而IPv4首部是4B的整数倍</p>
</li>
<li><p>IPv6只有在包的源结点（主机处）才能分片，是端到端的，传输路径中的路由器不能分片</p>
<ul>
<li><p>如果发到了路由器之后，想要转发出去的链路的MTU值小于IPv6的分片时，路由器会直接丢弃分片，并且返回ICMPv6协议的“分组过大”差错报告报文</p>
</li>
<li><p>IPv4在源结点和路由器上都可以进行分片</p>
</li>
</ul>
</li>
<li><p>IP v6协议使用ICMPv6协议报告差错和异常情况，附加报文类型有“分组过大”。</p>
</li>
<li><p>支持资源的预分配</p>
<ul>
<li>支持实时影像等要求，支持需要高带宽和低时延的应用。</li>
</ul>
</li>
<li><p>IPv6取消了协议字段，将协议字段改为下一个首部字段。</p>
</li>
<li><p>IPv6取消了首部长度字段和总长度字段，该用有效载荷字段。</p>
</li>
<li><p>IPv6取消了服务类型字段</p>
<ul>
<li>期望得到哪种类型的，可以设置数据报的优先级，IPv6该用优先级字段</li>
</ul>
</li>
<li><p>改进的选项</p>
</li>
<li><p>允许协议继续扩充</p>
</li>
<li><p>增大了安全性。身份验证和保密功能是IPv6的关键特征</p>
</li>
<li><p>支持Qos</p>
<ul>
<li><p>Qos指一个网络能够利用多种基础技术，为指定的网络通信提供更好的服务能力</p>
</li>
<li><p>Qos是网络的一种安全机制</p>
</li>
<li><p>Qos可以解决网络延迟和阻塞等问题</p>
</li>
<li><p>可以满足实时和多媒体通信的需要</p>
</li>
</ul>
</li>
</ul>
<h2 id="IPV6地址"><a href="#IPV6地址" class="headerlink" title="IPV6地址"></a>IPV6地址</h2><ul>
<li><p>基本类型地址</p>
<ul>
<li><p>单播：传统的点对点通信，可作为源地址和目的地址</p>
</li>
<li><p>多播：多播是一点对多点的通信，分组被交付到一组计算机的每台计算机，只可作为目的地址。多播包括广播。</p>
</li>
<li><p>任播</p>
<ul>
<li><p>这是IPv6增加的一种类型</p>
</li>
<li><p>表现为一对多中的一个通信，实质是单播通信，表现形式为多播通信，只可作为目的地址。</p>
</li>
<li><p>任播的目的站（目的IP地址）是一组计算机，但数据报在交付时只交付其中的一台计算机，通常是距离最近的一台计算机</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>IPv6地址表示形式</p>
<ul>
<li><p>一般形式：使用冒号十六进制算法</p>
<ul>
<li>每四位使用一个16进制数表示，每四个16进制数位一组，总共有8组</li>
</ul>
</li>
<li><p>压缩形式：</p>
<ul>
<li><p>零压缩：将一组内是四个连续的0的，写为一个0。例如4BF5:0:0:0:BA5F:A:0:2176</p>
</li>
<li><p>双冒号表示法：将几个相邻组都为0的，可以进一步缩写，写成一对冒号。例如FF05::3A:0:B3</p>
<ul>
<li>注意⚠️：双冒号表示法只能在一个地址中出现一次，如果出现两次，计算机就不能识别::中省略了多少位零。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="IPV4向IPV6过渡（IPv6如何兼容IPv4）"><a href="#IPV4向IPV6过渡（IPv6如何兼容IPv4）" class="headerlink" title="IPV4向IPV6过渡（IPv6如何兼容IPv4）"></a>IPV4向IPV6过渡（IPv6如何兼容IPv4）</h2><ul>
<li><p>双协议栈</p>
<ul>
<li><p>双协议栈技术是指在一台设备上同时装有IPv4和IPv6协议栈，那么这台设备既能和IPv4网络通信，又能和IPv6网络通信</p>
</li>
<li><p>如果这台设备是一台路由器，路由器的不同接口分别配置IPv4地址和IPv6地址，那么路由器内部就可以实现IPv4数据报与IPv6数据报的互相转换，也就是连接了IPv4和IPv6网络。</p>
</li>
<li><p>如果这台设备是一台计算机，那么它的一个接口将同时拥有IPv4地址和IPv6地址，并具备同时处理IPv4和IPv6协议的能力。</p>
</li>
</ul>
</li>
<li><p>隧道技术</p>
<ul>
<li><p>将整个IPv6数据报封装到IPv4数据报的数据部分，使得IPv6数据报可以在IPv4网络的隧道中传输</p>
</li>
<li><p>封装在IP v4数据报中的IPv6数据报在穿过IPv4网络后，会去掉IPv4首部，重新作为IPv6数据报进行正常传输</p>
</li>
<li><p>在互联网中广泛应用</p>
</li>
</ul>
</li>
</ul>
<h1 id="路由协议"><a href="#路由协议" class="headerlink" title="路由协议"></a>路由协议</h1><h2 id="路由信息协议（RIP）"><a href="#路由信息协议（RIP）" class="headerlink" title="路由信息协议（RIP）"></a>路由信息协议（RIP）</h2><ul>
<li><p>简介</p>
<ul>
<li><p>内部网关协议（IGP）中最先得到广泛应用的协议</p>
</li>
<li><p>是一种分布式的基于距离向量的路由选择协议，其最大优点就是简单</p>
</li>
</ul>
</li>
<li><p>路由表的内容</p>
<ul>
<li>目的网络，距离，下一跳路由器（如果是直接相连，就是直接交付）</li>
</ul>
</li>
<li><p>RIP协议只适用于小互联网</p>
</li>
<li><p>RIP的规定</p>
<ul>
<li><p>RIP协议要求网络中每个路由器都维护从自己到每一个网络的唯一最佳距离记录（即一组距离矢量之和）</p>
</li>
<li><p>跳数：</p>
<ul>
<li><p>从一个路由器到直接连接网络的跳数为1，距离基本单位为“跳” ，每到达一个路由器为一跳</p>
</li>
<li><p>RIP规定一条路径最多包含15个路由器，即最多允许15跳，超过15跳即为不可达。因此距离等于16时，表示网络不可达<img src="https://api2.mubu.com/v3/document_image/BEDB631967B94D461627205706.jpg" alt="img"></p>
</li>
</ul>
</li>
<li><p>路由信息在相邻路由之间交换</p>
</li>
<li><p>每30秒广播一次RIP路由更新信息，建立并维护路由表（动态路由表）</p>
</li>
<li><p>RIP协议中每个网络的子网掩码必须相同</p>
<ul>
<li>RIPv1的报文中不携带子网掩码，所以每个网路的子网掩码必须相同。</li>
</ul>
</li>
</ul>
</li>
<li><p>交换路由信息的特点</p>
<ul>
<li><p>仅和相邻路由器交换信息。</p>
</li>
<li><p>路由器交换的信息是当前路由器所知道的全部信息，即自己的路由表</p>
</li>
<li><p>每30秒交换一次路由信息，然后路由器根据新的路由信息更新路由表，若超过180s没有收到邻居路由器的通告，则判定邻居没了，并更新自己的路由表</p>
</li>
</ul>
</li>
<li><p>路由表更新过程</p>
<ul>
<li>路由器开始时，只知道直连网络的网络距离（&#x3D;1），然后通过相邻路由器交换并更新路由信息，使得若干次交换之后每一个路由器都知道到达本自治系统的任何一个网络的路由信息，即收敛。</li>
</ul>
</li>
<li><p>距离向量算法</p>
<ul>
<li><p>修改相邻路由器发来的RIP报文中的所有表项</p>
<ul>
<li>对地址为X的相邻路由器发来的RIP报文，修改所有项目：下一跳改为x，距离字段+1</li>
</ul>
</li>
<li><p>对修改后的RIP报文中的每一个项目，进行以下步骤</p>
<ul>
<li><p>若路由表中没有Net3，收到的RIP报文中有Net3，则将该项目填入路由表</p>
</li>
<li><p>若路由表中存在Net3，则查看路由表中的下一跳地址</p>
<ul>
<li><p>若下一跳是X，则用收到的项目替换路由表中的项目<br>因为路由表的更新以最新的消息为准，有可能链路发生了改变。无论距离增大还是减小，都会用新项目代替原来的项目</p>
</li>
<li><p>若下一跳不是X，则比较原来项目的距离长度和新项目的距离长度</p>
<ul>
<li><p>如果原来距离&gt;新距离，则更新</p>
</li>
<li><p>如果原来距离&lt;新距离，则不做处理</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>若180s还没收到相邻路由器X的更新信息，则把X记为不可达路由器，即将下一跳为X的项目的距离设置为16</p>
</li>
<li><p>重复上述步骤</p>
</li>
</ul>
</li>
<li><p>RIP协议的报文格式（不需要详细记忆）</p>
<ul>
<li><p>RIP报文的首部和路由部分，被添加到UDP用户数据报中</p>
</li>
<li><p>封装到UDP用户数据报中的报文是应用层报文，所以RIP是应用层协议</p>
</li>
<li><p>每条路由信息为20字节，所以每个RIP报文最多传送25个路由，如果路由表中超过25个路由，则需要分别发送几个RIP报文。</p>
</li>
</ul>
</li>
<li><p>缺陷</p>
<ul>
<li><p>RIP限制了网络的规模，它能使用的最大距离为15 （16表示不可达）</p>
</li>
<li><p>路由器之间交换的是路由器中的完整路由表，因此网络规模越大，开销也越大</p>
</li>
<li><p>网络出现故障时，会出现慢收敛现象（即需要较长时间才能将此信息传送到所有路由器），俗称“坏消息传得慢与好消息传得快”</p>
<ul>
<li><p>假设第0秒的时候，R1刚刚向R2交换完路由信息，R1的直连网络Net1就断了，此时R1就会将到达Net1网络的距离设为16，但是此时不会向R2发送路由信息，需要等到30s之后。在这期间R1很可能就收到R2的路由表，在这期间可能收到了R2的路由信息，R1发现R2可以到达网络1，R1就更改到达Net1的距离为3。</p>
</li>
<li><p>此时R2再次收到R1的路由表时，发现R1到达Net1的距离&#x3D;3，R2就会修改到达Net1的距离&#x3D;4，此时R2的路由表项：Net1，4，R1。R1的路由表项：Net1，3，R2。</p>
</li>
<li><p>出现这种情况的原因是，R1和R2都认为对方可以到达Net1，结果双方都到达不了Net1，导致R1和R2需要不断的更新路由表项距离，双方不断更新，即距离+1，只有等到距离&#x3D;16时，R1和R2才知道不能到达Net1，坏消息更新的慢就是只有等很长一段时间。</p>
</li>
<li><p>不仅是故障问题，同样如果链路开销增加了，相邻路由器同样需要经过一段时间才能将距离更新到正确的状态。但是如果发现了一条更短的路由，那么相邻路由器只需要更新一次，路由表项的距离就可以更新到正确的状态。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li>实现简单、开销小、收敛过程较快</li>
</ul>
</li>
</ul>
<h2 id="开放最短路径优先（OSPF）协议"><a href="#开放最短路径优先（OSPF）协议" class="headerlink" title="开放最短路径优先（OSPF）协议"></a>开放最短路径优先（OSPF）协议</h2><ul>
<li><p>简介</p>
<ul>
<li><p>使用分布式链路状态路由算法的典型代表，也是内部网关协议（IGP）的一种</p>
</li>
<li><p>开放：不受某一家厂商控制，公开发表的</p>
</li>
<li><p>最短路径优先：是用来最短路径算法SPF</p>
</li>
</ul>
</li>
<li><p>链路状态路由算法</p>
<ul>
<li><p>链路建立时</p>
<ul>
<li><p>每个路由器向邻居结点发送【HELLO问候分组】，并了解邻居结点的网络地址（每10秒发生一次HELLO，判断临站是否可达）</p>
</li>
<li><p>每个路由器设置到每个邻居的成本度量metric</p>
</li>
<li><p>构造【DD数据库描述分组】，向邻站给出自己链路状态数据库中的所有链路状态 项目的摘要信息。</p>
</li>
<li><p>如果邻站有DD分组中的所有信息，则不做处理；如果邻站有一些数据没有，或者有一些数据不一样（更新的），则发送【LSR链路状态请求分组】，请求这些信息。</p>
</li>
<li><p>收到邻站的LSR请求，发送【LSU链路状态更新分组】。</p>
</li>
<li><p>邻站收到LSU更新分组后会进行更新，更新结束后就会返回一个【LSAck链路状态确认分组】进行确认。</p>
</li>
</ul>
</li>
<li><p>链路状态发生变化时</p>
<ul>
<li><p>如果路由器的链路状态发生变化，则泛洪发送【LSU链路状态更新分组】。</p>
</li>
<li><p>其它站点更新完毕后，会返回一个【LSAck链路状态确认分组】进行确认。</p>
</li>
</ul>
</li>
<li><p>使用Dijkstra算法根据自己的链路状态数据库构造到各个节点的最短路径</p>
</li>
</ul>
</li>
<li><p>分组类型</p>
<ul>
<li><p>问候分组，用来发现和维持邻站的可达性</p>
</li>
<li><p>数据库描述分组，向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息</p>
</li>
<li><p>链路状态请求分组，向对方请求发送某些链路状态项目的详细信息</p>
</li>
<li><p>链路状态更新分组，用洪泛法对全网更新链路状态</p>
</li>
<li><p>链路状态确认分组，对链路更新分组的确认</p>
</li>
</ul>
</li>
<li><p>OSPF的区域</p>
<ul>
<li><p>为了使OSPF能够适用规模较大的网络，OSPF将较大的自治系统再划分，形成若干个区域。</p>
</li>
<li><p>每个区域都有一个32位的区域标识符（点分十进制表示），与IP地址完全不同，只在AS内有效。</p>
</li>
<li><p>主干区域：0.0.0.0，用来连接区域不同的区域。</p>
</li>
<li><p>主干路由器：主干区域的路由器，可能包括区域边界路由器</p>
</li>
<li><p>自治系统边界路由器：该路由器位于主干区域，用于连接其它自治系统。</p>
</li>
<li><p>区域内部路由器：在下层区域中的路由器</p>
</li>
<li><p>区域边界路由器：区域间</p>
</li>
</ul>
</li>
<li><p>OSPF分组</p>
<ul>
<li><p>OSPF分组首部+类型1至类型5的OSPF分组，封装上IP数据报首部，形成IP数据报</p>
</li>
<li><p>OSPF使用IP数据报进行传送，属于网络层协议。</p>
</li>
</ul>
</li>
<li><p>交换路由信息的特点</p>
<ul>
<li><p>OSPF向本自治系统中的所有路由器发送信息，这里使用的方法是洪泛法</p>
<ul>
<li><p>路由器A先向相邻路由器发送路由信息，相邻路由器将路由信息的副本保存下来，再通过所有连接路由器的接口转发出去，所以所有的路由器都会在极短的时间内知道路由器A的路由信息</p>
</li>
<li><p>类似于广播</p>
</li>
</ul>
</li>
<li><p>发送的信息是与本路由器相邻的所有路由器的链路状态</p>
<ul>
<li>链路状态：相邻路由器路由器，以及到相邻路由器的链路的度量&#x2F;代价（代价可以是费用、距离、时延、带宽）</li>
</ul>
</li>
<li><p>只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息，并且更新过程收敛得快，平时链路状态没有发生变化时，路由器不会发送路由信息</p>
</li>
<li><p>所有路由器最后都能建立一个链路状态数据库，即全网拓扑<img src="https://api2.mubu.com/v3/document_image/AEF439594C8742931627284544.jpg" alt="img"></p>
</li>
<li><p>OSPF是网络层协议，它不使用UDP或TCP，而直接用IP数据报传送</p>
</li>
</ul>
</li>
<li><p>其他特点</p>
<ul>
<li><p>每隔30min更新一次数据库中的链路状态</p>
<ul>
<li>链路状态数据库中的每条LSA只有30分钟的有效时间，所以即使数据链路没有发生变化，也会在30分钟之后发送LSR请求链路状态信息。</li>
</ul>
</li>
<li><p>适用于规模较大的网络</p>
<ul>
<li>由于LSU更新分组中只有路由器相邻结点的链路状态信息，所以LSU更新分组的大小与网络的规模无直接关系，所以适用于规模较大的网络。</li>
</ul>
</li>
<li><p>出现链路断开的情况，收敛速度快</p>
<ul>
<li>OSPF收到链路状态信息后会使用Dijkstra算法算出最短路径，所以知道全网拓扑，直接计算出最短路径，所以收敛速度快（RIP协议之所以慢是因为R1不知道全网拓扑，它误以为R2可以到，就发给R2）</li>
</ul>
</li>
<li><p>OSPF对不同的链路可根据IP分组的不同服务类型（TOS ）而设置成不同的代价</p>
</li>
<li><p>OSPF对于不同类型的业务可计算出不同的路由，十分灵活</p>
</li>
<li><p>负载平衡：如果到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径</p>
</li>
<li><p>所有在OSPF路由器之间交换的分组都具有鉴别功能，因而保证了仅在可信赖的路由器之间交换链路状态信息</p>
</li>
<li><p>支持可变长度的子网划分和无分类编址CIDR</p>
</li>
<li><p>每个链路状态都带上一个32位的序号，序号越大，状态就越新</p>
</li>
<li><p>使用迪杰斯特拉算法</p>
</li>
<li><p>使用洪泛法，就像水波一样，相互交互路由表信息</p>
</li>
</ul>
</li>
</ul>
<h2 id="边界网关协议（BGP）"><a href="#边界网关协议（BGP）" class="headerlink" title="边界网关协议（BGP）"></a>边界网关协议（BGP）</h2><ul>
<li><p>简介</p>
<ul>
<li><p>是不同自治系统的路由器之间交换路由信息的协议，是一种外部网关协议</p>
</li>
<li><p>边界网关协议常用于互联网的网关之间</p>
</li>
<li><p>BGP采用的是路径向量路由选择协议</p>
</li>
<li><p>应用层协议，基于TCP</p>
</li>
</ul>
</li>
<li><p>交换路由信息的特点</p>
<ul>
<li><p>与其他AS的邻站（BGP发言人）交换信息</p>
<ul>
<li><p>每个自治系统的管理员要选择至少一个路由器作为该自治系统的“BGP发言人”</p>
</li>
<li><p>BGP发言人往往是BGP边界路由器</p>
</li>
</ul>
</li>
<li><p>交换的信息是网络可达性信息，即到达某个网络所要经过的一系列AS</p>
<ul>
<li><p>一个BGP发言人与其他自治系统中的BGP发言人要交换路由信息，先建立TCP连接，即通过TCP传送</p>
</li>
<li><p>在此连接上交换BGP报文以建立BGP会话，再利用BGP会话交换路由信息</p>
</li>
<li><p>所有BGP发言人都相互交换网络可达性的信息后，各BGP发言人就可找出到达各个自治系统的较好路由</p>
</li>
</ul>
</li>
<li><p>发生变化的时候才会更新有变化的部分</p>
</li>
</ul>
</li>
<li><p>BGP协议交换信息的过程</p>
<ul>
<li><p>BGP发言人交换路径向量</p>
<ul>
<li><p>AS2的BGP发言人发给AS1的BGP发言人：到达网络Net1、Net3，可以经过AS2</p>
</li>
<li><p>AS3的BGP发言人发给AS1的BGP发言人：到达网络Net4、Net5，可以经过AS3</p>
</li>
<li><p>AS1发给AS2：到达Net4、Net5，可以经过AS1、AS3</p>
</li>
<li><p>AS1发给AS3:到达Net1、Net3，可以经过AS1、AS2</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>BGP报文格式</p>
<ul>
<li><p>BGP报文通用首部+主体部分，封装上TCP首部，形成TCP报文</p>
</li>
<li><p>BGP是应用层协议，借助TCP传送</p>
<ul>
<li>为什么使用TCP：更加可靠，可以简化路由选择协议</li>
</ul>
</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li><p>BGP交换路由信息的结点数量级是自治系统的数量级，要比这些自治系统中的网络数少很多</p>
</li>
<li><p>每个自治系统中BGP发言人（或边界路由器）的数目是很少的</p>
</li>
<li><p>BGP支持CIDR，即BGP路由表应包括目的网络前缀，下一跳路由器，以及到达该网络的各个自治系统序列。</p>
</li>
<li><p>在BGP刚运行时， BGP的邻站交换整个BGP路由表，但以后只需在发生变化时更新有变化的部分</p>
</li>
</ul>
</li>
<li><p>BGP-4的四种报文类型</p>
<ul>
<li><p>打开（Open ）报文：用来与相邻的另一个BGP发言人建立关系，并认证发送方（身份认证）</p>
</li>
<li><p>更新（ Update ）报文：通知新路径或撤销原路径</p>
</li>
<li><p>保活（ Keepalive ）报文：用来确认打开报文或者在没有更新时周期性地证实邻站关系</p>
</li>
<li><p>通知（ Notification ）报文：用来发送检测到的差错，也被用于关闭TCP连接</p>
</li>
</ul>
</li>
</ul>
<h2 id="路由协议比较"><a href="#路由协议比较" class="headerlink" title="路由协议比较"></a>路由协议比较</h2><ul>
<li><p>协议：RIP、OSPF、BGP</p>
</li>
<li><p>类型：内部、内部、外部</p>
</li>
<li><p>路由算法：距离-向量、链路状态、路径-向量</p>
</li>
<li><p>传递协议：UDP、IP、TCP</p>
</li>
<li><p>路径选择：跳数最少、代价最低、较好，非最佳</p>
</li>
<li><p>交换结点：和本结点相邻的路由器、网络中的所有路由器、和本结点相邻的路由器</p>
</li>
<li><p>交换内容：当前本路由器知道的全部信息，即自己的路由器、与本路由器相邻的所有路由器的链路状态(只有发生变化时才交换)、(首次)整个路由表，(非首次)有变化的部分</p>
</li>
<li><p>层次结构：应用层、网络层、应用层</p>
</li>
</ul>
<h1 id="IP组播"><a href="#IP组播" class="headerlink" title="IP组播"></a>IP组播</h1><h2 id="IP数据报的三种传输方式"><a href="#IP数据报的三种传输方式" class="headerlink" title="IP数据报的三种传输方式"></a>IP数据报的三种传输方式</h2><ul>
<li><p>单播：用于一个主机发送数据包给一个主机，一个单播地址作为源地址，一个单播地址作为目的地址。点对点传输。</p>
</li>
<li><p>广播：用于一台主机发送数据包给局域网中的所有主机，一个单播地址作为源地址，广播地址全1作为目的地字。点对多点传输。</p>
</li>
<li><p>组播（多播）：用于一台主机发送数据包给多台主机，一个单播地址作为源地址，组播地址（D类）作为目的地址。点对多点传输。</p>
<ul>
<li><p>借助组播路由协议为组播数据包建立组播分发树，被传递的数据到达距离用户端尽可能近的节点后才会被复制和分发。</p>
</li>
<li><p>广播报文遇到一个路由器或交换机，就会复制一次，并从所有端口转发出去。</p>
</li>
<li><p>组播报文在前期经过路由器或交换机的时候，只会在特定的端口转发出去，只有到达距离目的主机尽可能近的设备时，才会复制数据包和并从多个端口转发出去。</p>
</li>
</ul>
</li>
<li><p>对比：视频服务器</p>
<ul>
<li><p>单播：90个用户要求观看视频，会建立90个单播连接，源站点会发送90个数据包分发给90个主机。那么距离源站点越近的线路上占用的资源越多。</p>
</li>
<li><p>组播：源站点会发送一份数据包，遇到路由器或交换机，根据组播地址判断是否复制数据包，直到到达目的主机。这样每条链路上都只有一个数据包。</p>
<ul>
<li><p>所以组播可以提高数据传输效率，减少了主干网出现拥塞的可能性。</p>
</li>
<li><p>组播组中的主机可以在一个物理网络中，也可以在不同的物理网络中，在不同的物理网络中时，需要有组播路由器的支持（即运行组播协议的路由器）。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="组播的概念"><a href="#组播的概念" class="headerlink" title="组播的概念"></a>组播的概念</h2><ul>
<li><p>概述</p>
<ul>
<li><p>组播机制是让源计算机一次发送的单个分组可以抵达用一个组地址标识的若干目标主机，并被它们正确接收</p>
<ul>
<li>组播仅应用于UDP</li>
</ul>
</li>
<li><p>因特网中的IP组播也使用组播组的概念，每个组都有一个特别分配的地址，要给该组发送的计算机将使用这个地址作为分组的目标地址</p>
</li>
</ul>
</li>
<li><p>实现过程</p>
<ul>
<li><p>主机使用一个称为IGMP （因特网组管理协议）的协议加入组播组</p>
</li>
<li><p>使用该协议通知本地网络上的路由器关于要接收发送给某个组播组的分组的愿望</p>
</li>
<li><p>通过扩展路由器的路由选择和转发功能，可以在许多路由器互联的支持硬件组播的网络上面实现因特网组播</p>
</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li>数据只需发送一次就可发送到所有接收者，大大减轻了网络的负载和发送者的负担</li>
</ul>
</li>
<li><p>注意</p>
<ul>
<li>组播需要路由器的支持才能实现，能够运行组播协议的路由器称为组播路由器</li>
</ul>
</li>
</ul>
<h2 id="IP组播地址"><a href="#IP组播地址" class="headerlink" title="IP组播地址"></a>IP组播地址</h2><ul>
<li><p>概述</p>
<ul>
<li><p>组播组中的设备除了拥有自己的全球唯一的IP地址外，都会被分配一个组播组IP地址（即D类地址），属于同一个组播组的设备都将会被分配同一个组播组地址。</p>
</li>
<li><p>组播地址是在加入组播组的时候，才会被分配。</p>
</li>
</ul>
</li>
<li><p>结构</p>
<ul>
<li><p>IP组播使用D类地址格式：224.0.0.0～239.255.255.255</p>
</li>
<li><p>组播地址只能作为分组的目的地址，单播地址才能作为分组的源地址。</p>
</li>
</ul>
</li>
<li><p>组播数据报和一般的IP数据报的区别</p>
<ul>
<li><p>组播数据报也是“尽最大努力交付”，不提供可靠交付，应用于UDP</p>
<ul>
<li>为什么？速度较快，组播数据报一般对实时性要求很高</li>
</ul>
</li>
<li><p>组播地址只能用于目的地址，而不能用于源地址</p>
</li>
<li><p>对组播数据报不产生ICMP差错报文。</p>
<ul>
<li>因此，若在PING命令后面键入组播地址，将永远不会收到响应</li>
</ul>
</li>
<li><p>并非所有的D类地址都可作为组播地址</p>
<ul>
<li>一部分地址已经被指派为永久组地址了。</li>
</ul>
</li>
</ul>
</li>
<li><p>分类</p>
<ul>
<li><p>只在本局域网上进行硬件组播</p>
</li>
<li><p>在因特网的范围内进行组播（因特网上进行组播的最后阶段，还是要把组播数据报在局域网上用硬件组播交付给组播组的所有成员）</p>
</li>
</ul>
</li>
<li><p>同单播地址一样，组播IP地址也需要相应的组播MAC地址在本地网络中实际传送数据帧。组播MAC地址以16进制值01-00-5E开头，剩下的6个16进制数是根据IP组播地址的最后23位转换而来。</p>
<ul>
<li>组播IP地址的第5位-第9位没有写入组播MAC地址地址中，如果有两个组播IP的后23位相同，可能使得两个组播组混到一起，解决办法：<ul>
<li>硬件地址的映射关系不是唯一的，因此收到组播数据报的主机，还要在IP层利用软件进行过滤，把不是本主机要接收的数据报丢弃</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="IGMP与组播路由算法"><a href="#IGMP与组播路由算法" class="headerlink" title="IGMP与组播路由算法"></a>IGMP与组播路由算法</h2><ul>
<li><p>用途</p>
<ul>
<li><p>因特网组管理协议（ IGMP ）：要使路由器知道组播组成员的信息</p>
<ul>
<li><p>IGMP协议让路由器知道本局域网上是否有主机（的进程）加入或退出了某个组播组。</p>
</li>
<li><p>IGMP协议决定路由器在局域网中只发给加入组播组的主机，而不发给组播组外的主机。</p>
</li>
<li><p>IGMP协议不知道在所连接的局域网内加入组播组的成员个数，也不知道他们分布在哪些网络，只知道（各个接口）所连接的局域网内有无组播组的成员。</p>
</li>
</ul>
</li>
<li><p>组播路由选择协议：组播数据报和一般的单播的路由选择协议（OSPF、RIP等）有所不同，需要有单独的路由选择协议。</p>
<ul>
<li>组播路由选择协议：在因特网范围上把组播数据报用最小的代价发给所有组成员。</li>
</ul>
</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li><p>IGMP是TCP&#x2F;IP的一部分</p>
</li>
<li><p>IGMP是网络层协议，使用IP数据包传递报文。</p>
</li>
</ul>
</li>
<li><p>工作阶段</p>
<ul>
<li><p>第一阶段</p>
<ul>
<li><p>主机加入新的组播组时，该主机向组播组的组播地址发送一个IGMP报文，声明要成为该组的成员</p>
</li>
<li><p>本地的组播路由器收到IGMP报文后，将组成员关系转发给因特网上的其他组播路由器</p>
<ul>
<li>所以组播路由器和同一组播组内的主机都会收到这个IGMP报文</li>
</ul>
</li>
</ul>
</li>
<li><p>第二阶段</p>
<ul>
<li><p>本地组播路由器周期性地探询本地局域网上的主机，以便知道这些主机是否仍继续是组的成员</p>
<ul>
<li>探询：就是发送IGMP的询问报文</li>
</ul>
</li>
<li><p>响应结果</p>
<ul>
<li><p>只要所连接局域网中某个组中有一台主机响应，那么组播路由器就认为在所连接的局域网内这个组是活跃的</p>
<ul>
<li>如果一台主机响应了，其他主机收到响应报文后，就不再发送响应报文</li>
</ul>
</li>
<li><p>一个组在经过几次的探询后仍然没有一台主机响应时，则不再将该组的成员关系转发给其他的组播路由器</p>
<ul>
<li>成员关系：所连接局域网中有无组播组的成员</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>组播路由选择协议</p>
<ul>
<li><p>目的：找出以源主机为根节点的组播转发树</p>
<ul>
<li><p>构造树形接口可以避免在路由器之间兜圈子</p>
</li>
<li><p>对于不同的组播组，有不同的组播转发树；对于同一个组播组，如果源点不同，也会有不同的组播转发树</p>
</li>
</ul>
</li>
<li><p>三种算法：</p>
<ul>
<li><p>三种路由算法基于链路状态的路由选择</p>
</li>
<li><p>基于距离—向量的路由选择</p>
</li>
<li><p>协议无关的组播（ PIM ） （可以建立在任何路由器协议之上）</p>
<ul>
<li><p>与单播路由协议无关，直接利用已有的单播路由表，而不需要额外自己维护专门的单播路由信息。</p>
</li>
<li><p>稀疏&#x2F;密集：根据组播组的稀疏程度使用协议无关的组播的不同算法</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="移动IP"><a href="#移动IP" class="headerlink" title="移动IP"></a>移动IP</h1><h2 id="移动IP的概念"><a href="#移动IP的概念" class="headerlink" title="移动IP的概念"></a>移动IP的概念</h2><ul>
<li><p>支持移动性的因特网体系结构与协议共称为移IP，它是为了满足移动结点（计算机、服务器、网段等）在移动中保持其连接性而设计的</p>
</li>
<li><p>三种功能实体和两种地址</p>
<ul>
<li><p>移动结点：具有永久IP地址的移动结点（设备）</p>
</li>
<li><p>本地代理：在一个网络环境中，一个移动结点的永久“居所”被称为归属网络，在归属网络中代表移动结点执行移动管理功能的实体称为归属代理（本地代理） ，它根据移动用户的转交地址，采用隧道技术转交移动结点的数据包</p>
<ul>
<li><p>本地代理：在归属网络中管理并且帮助移动结点执行功能的设备。</p>
</li>
<li><p>路由器也可以作为本地代理</p>
</li>
</ul>
</li>
<li><p>外部代理：在外部网络中帮助移动结点完成移动管理功能的实体称为外部代理</p>
</li>
<li><p>永久地址（归属地址&#x2F;主地址）：移动结点在归属网络中的原始地址。</p>
</li>
<li><p>转交地址（辅地址）：可以是外部代理的地址，也可以是动态配置的一个地址。</p>
</li>
</ul>
</li>
<li><p>移动IP与动态IP</p>
<ul>
<li><p>动态IP：局域网中的计算机可以通过网络中的DHCP服务器动态地获得一个IP地址</p>
</li>
<li><p>移动IP：移动结点以固定的网络IP地址实现跨越不同网段的漫游功能，并保证基于网络IP的网络权限在漫游过程中不发生任何改变</p>
</li>
</ul>
</li>
</ul>
<h2 id="移动IP通信过程"><a href="#移动IP通信过程" class="headerlink" title="移动IP通信过程"></a>移动IP通信过程</h2><ul>
<li><p>可以理解为呼叫转移</p>
<ul>
<li><p>移动结点在本地网时，按传统的TCP&#x2F;IP方式进行通信（在本地网中有固有的地址）</p>
</li>
<li><p>移动结点到一个外地网络时，移动结点向本地代理注册当前的位置地址，即转交地址</p>
</li>
<li><p>转交地址的注册后，本地地址会将截获的信息通过隧道发送给转交地址</p>
</li>
<li><p>到达转交地址，恢复成原来数据，发送给移动结点</p>
</li>
</ul>
</li>
<li><p>移动结点在外网通过外网的路由器或外部代理向通信对端发送IP数据包</p>
</li>
<li><p>移动结点来到另一个外网时，只需向本地代理更新注册的转交地址，就可继续通信。</p>
</li>
<li><p>移动结点回到本地网时，移动结点向本地代理注销转交地址，这时移动结点又将使用传统的TCP&#x2F;IP方式进行通信</p>
</li>
</ul>
<h2 id="移动IP通信过程-1"><a href="#移动IP通信过程-1" class="headerlink" title="移动IP通信过程"></a>移动IP通信过程</h2><ul>
<li><p>A刚进入外部网络：</p>
<ul>
<li><p>1.获得外部代理的地址作为转交地址（转交地址可以是外部代理的地址，也可以是动态配置的地址），或者向外部代理注册一个转交地址</p>
<ul>
<li><p>被动获得：外部代理广播ICMP报文，报文中包含外部代理的地址，将作为A的转交地址</p>
</li>
<li><p>主动获得：A向外部代理发送广播报文，获得一个转交地址</p>
</li>
</ul>
</li>
<li><p>2.移动节点通过外部代理发送“注册报文”给归属代理（包含A的永久地址&amp;外部代理的转交地址）</p>
</li>
<li><p>3.归属代理接收请求，并将移动节点的永久地址和转交地址绑定，并返回“注册响应报文”</p>
<ul>
<li>之后到达归属代理的数据报且要发给移动节点A的数据报将会被封装，并以隧道的方式转发给转交地址。</li>
</ul>
</li>
<li><p>4.外部代理接收“注册响应”，并转发给移动节点。</p>
</li>
</ul>
</li>
<li><p>A移动到新的外部网络：</p>
<ul>
<li><p>1.获得新的外部代理的地址作为转交地址，或者移动节点在新的外部代理登记注册一个转交地址</p>
</li>
<li><p>2.移动节点A用新获取的转交地址覆盖旧的转交地址</p>
</li>
<li><p>3.同上</p>
</li>
</ul>
</li>
<li><p>A回到归属网络</p>
<ul>
<li><p>1.A向本地代理注销A的转交地址</p>
</li>
<li><p>2.同上</p>
</li>
</ul>
</li>
</ul>
<h1 id="网络层设备"><a href="#网络层设备" class="headerlink" title="网络层设备"></a>网络层设备</h1><h2 id="路由器的组成和功能"><a href="#路由器的组成和功能" class="headerlink" title="路由器的组成和功能"></a>路由器的组成和功能</h2><ul>
<li><p>基本描述</p>
<ul>
<li>路由器是一种具有多个输入&#x2F;输出端口的专用计算机<ul>
<li>多个输入端口和多个输出端口：连接多台主机和多个网络</li>
</ul>
</li>
</ul>
</li>
<li><p>任务</p>
<ul>
<li>连接不同的网络（连接异构网络）并完成路由转发（路由选择、分组转发）</li>
</ul>
</li>
<li><p>功能</p>
<ul>
<li><p>可以隔离广播域</p>
</li>
<li><p>重点：不同层次的设备隔离不同的域</p>
<ul>
<li><p>集线器：不隔离</p>
</li>
<li><p>网桥：隔离碰撞域（所以有广播风暴）</p>
</li>
<li><p>路由器：隔离广播域</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>工作过程</p>
<ul>
<li><p>源主机和目标主机在同一个网络上，那么直接交付而无须通过路由器</p>
</li>
<li><p>源主机和目标主机不在同一个网络上，路由器按照转发表指出的路由将数据报转发给下一个路由器，即间接交付</p>
</li>
</ul>
</li>
<li><p>功能组成</p>
<ul>
<li><p>路由选择部分（控制部分）</p>
<ul>
<li><p>核心构件：路由选择处理机</p>
</li>
<li><p>任务</p>
<ul>
<li><p>根据选定的路由选择协议构造出路由表</p>
</li>
<li><p>和其他相邻路由器交换路由信息然后更新和维护路由表</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>分组转发部分（三部分）</p>
<ul>
<li><p>交换结构</p>
<ul>
<li><p>根据转发表对分组进行处理，将从输入口进入的分组从一个合适的输出端口转发出去</p>
<ul>
<li>转发表：由路由表得到</li>
</ul>
</li>
<li><p>不同分组的转发情况</p>
<ul>
<li><p>若收到RIP&#x2F;OSPF分组等，则将分组送给路由选择处理机</p>
<ul>
<li>也就是RIP&#x2F;OSPF启动时</li>
</ul>
</li>
<li><p>若收到数据分组，则差咋后转发表并输出</p>
</li>
</ul>
</li>
<li><p>交换方法</p>
<ul>
<li><p>通过存储器进行交换</p>
</li>
<li><p>通过总线进行交换</p>
</li>
<li><p>通过互联网络进行交换</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>一组输入端口</p>
<ul>
<li><p>从物理层接收到的比特流中提取出链路层帧，进而从帧中提取出网络层数据报</p>
<ul>
<li><p>判断是否是路由器之间交换路由信息的分组，如果是则交付给路由选择处理机；如果不是则交付给交换结构</p>
</li>
<li><p>网络层处理分组时需要排队，数据分组查表和转发都会产生时延</p>
</li>
<li><p>输入端口的查找和转发功能在路由器的交换功能中是最重要的</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>一组输出端口</p>
<ul>
<li><p>将数据报变为比特流发送到物理层</p>
<ul>
<li><p>网络层处理分组时需要排队，网络层处理模块有缓存管理（当网络层处理来不及时，就会先放入缓存），也会产生时延</p>
</li>
<li><p>如果路由器处理分组的速率赶不上分组进入队列的速率，则队列的存储空间最终必定减少到零，这就使得再进入的分组没有存储空间而被丢弃</p>
</li>
<li><p>所以路由器输入和输出队列产生溢出是造成分组丢失的重要原因</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>注意</p>
<ul>
<li>如果一个存储转发设备实现了某个层次的功能，那么它就可以互联两个在该层次上使用不同协议的网段（网络）</li>
</ul>
</li>
<li><p>功能</p>
<ul>
<li><p>分组转发</p>
<ul>
<li><p>处理通过路由器的数据流</p>
</li>
<li><p>转发表查询、转发及相关的队列管理和任务调度等</p>
</li>
</ul>
</li>
<li><p>路由计算</p>
<ul>
<li>通过和其他路由器进行基于路由协议的交互，完成路由表的计算</li>
</ul>
</li>
</ul>
</li>
<li><p>三层设备的区别</p>
<ul>
<li><p>路由器：是面向协议的，依据网络地址进行操作，并进行路径选择、分段、帧格式转换、对数据报的生存时间和流量进行控制等。能隔离冲突域和广播域。</p>
<ul>
<li>面向协议：互联两个不同网络层协议的网络</li>
</ul>
</li>
<li><p>网桥：与高层协议无关。能隔离冲突域，不能隔离广播域</p>
<ul>
<li>可以互联两个物理层和链路层不同的网段</li>
</ul>
</li>
<li><p>集线器：不能隔离冲突域和广播域</p>
<ul>
<li>不能互联两个物理层不同的网段</li>
</ul>
</li>
<li><p>错误🙅‍♂️：所有设备都可互联所在层次与以下层次不同协议的网段。因为集线器就不能互联网络层的网段。</p>
</li>
</ul>
</li>
<li><p>支持协议</p>
<ul>
<li>OSI、TCP&#x2F;IP、IPX等</li>
</ul>
</li>
</ul>
<h2 id="路由表与路由转发"><a href="#路由表与路由转发" class="headerlink" title="路由表与路由转发"></a>路由表与路由转发</h2><ul>
<li><p>路由表功能：实现路由选择，通常用软件实现（用路由算法得出）</p>
<ul>
<li>路由选择：涉及很多路由器，路由表是许多路由器协同工作的结果</li>
</ul>
</li>
<li><p>路由表结构</p>
<ul>
<li><p>目的网络IP地址</p>
</li>
<li><p>子网掩码</p>
</li>
<li><p>下一跳IP地址</p>
</li>
<li><p>接口</p>
</li>
</ul>
</li>
<li><p>默认路由（路由表中）：目的网络：0.0.0.0，子网掩码：0.0.0.0</p>
<ul>
<li>目的：减少转发表的重复项目，使用一个默认路由代替所有具有相同“下一跳”的项目<ul>
<li>不知道往哪发的分组，全都发送给默认路由的下一跳</li>
</ul>
</li>
</ul>
</li>
<li><p>转发表：由路由表的来，可以用软件实现，也可以由硬件实现</p>
<ul>
<li><p>转发表必须包含完成转发功能所必需的信息，在转发表的每一行必须包含：要到达的目的网络、输出端口、某些MAC地址信息的映射</p>
</li>
<li><p>转发：路由器根据转发表把收到的IP数据报从合适的端口转发出去，仅涉及一个路由器</p>
</li>
</ul>
</li>
</ul>

    </div>

    
    
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%86%99%E4%BD%9C/" rel="tag"># 写作</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/02/04/%E8%AE%A1%E7%AE%97%E6%9C%BA408_4.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_3.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/" rel="prev" title="数据链路层">
                  <i class="fa fa-chevron-left"></i> 数据链路层
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/02/04/%E8%AE%A1%E7%AE%97%E6%9C%BA408_4.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_5.%E4%BC%A0%E8%BE%93%E5%B1%82/" rel="next" title="传输层">
                  传输层 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">manana</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
